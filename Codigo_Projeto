==================================================

unit Unit3;

interface
uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf, FireDAC.Stan.Def,
  FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys, FireDAC.VCLUI.Wait,
  FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf, FireDAC.DApt,
  Vcl.StdCtrls, Data.DB, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  FireDAC.Phys.MSAcc, FireDAC.Phys.MSAccDef, Vcl.Buttons, Vcl.Grids, Vcl.DBGrids,
  Vcl.ExtCtrls, Vcl.Imaging.jpeg, Vcl.Menus, Unit4,Unit5;

type
  TForm3 = class(TForm)
    FDConnection1: TFDConnection;
    TB_USUARIOS: TFDTable;
    Conectar: TButton;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    nome: TEdit;
    sobrenome: TEdit;
    permissao: TEdit;
    idade: TEdit;
    STATUS: TLabel;
    Button1: TButton;
    Button2: TButton;
    Button3: TButton;
    Button4: TButton;
    Button5: TButton;
    Button6: TButton;
    Button7: TButton;
    SpeedButton1: TSpeedButton;
    DataSource1: TDataSource;
    DBGrid1: TDBGrid;
    OpenDialog1: TOpenDialog;
    Image1: TImage;
    Button8: TButton;
    Button9: TButton;

    procedure ConectarClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure TB_USUARIOSBeforePost(DataSet: TDataSet);
    procedure TB_USUARIOSBeforeInsert(DataSet: TDataSet);
    procedure Button3Click(Sender: TObject);
    procedure Button6Click(Sender: TObject);
    procedure Button7Click(Sender: TObject);
    procedure Button4Click(Sender: TObject);
    procedure DBGrid1DblClick(Sender: TObject);
    procedure Button8Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Sobre1Click(Sender: TObject);
    procedure Saida1Click(Sender: TObject);
    procedure Button9Click(Sender: TObject);
  private
    procedure limpa;
    procedure bloqueia;
    procedure carrega;
  public
    { Public declarations }
  end;

var
  Form3: TForm3;

implementation

{$R *.dfm}


procedure TForm3.limpa;
begin
  nome.text := '';
  sobrenome.text  := '';
  permissao.Text := '';
  idade.Text := '';

end;





procedure TForm3.Saida1Click(Sender: TObject);
begin
close
end;

procedure TForm3.Sobre1Click(Sender: TObject);
begin
 form4.show;

end;

procedure tform3.bloqueia;
begin
nome.Enabled        := not nome.enabled;
sobrenome.Enabled   := not sobrenome.Enabled ;
permissao.Enabled   := not permissao.Enabled;
idade.Enabled       := not idade.Enabled  ;

end;

procedure TForm3.carrega;

begin
  nome.Text       := tb_usuarios.FieldByName('nome').value       ;
  sobrenome.Text  := tb_usuarios.FieldByName('sobrenome').value  ;
  permissao.Text  := tb_usuarios.FieldByName('permissao').value  ;
  idade.Text      := tb_usuarios.FieldByName('idade').value  ;
 if tb_usuarios.FieldByName('foto').value <> null   then
   begin
      if fileexists(tb_usuarios.FieldByName('foto').value) then
        Image1.Picture.LoadFromFile(tb_usuarios.FieldByName('foto').value)
   end
   else
    begin
            Image1.Picture :=nil ;
    end;





end;


procedure TForm3.Button1Click(Sender: TObject);
begin
tb_usuarios.Insert;
limpa;
end;

procedure TForm3.Button2Click(Sender: TObject);
begin
bloqueia;
tb_usuarios.Edit;
end;

procedure TForm3.Button3Click(Sender: TObject);
begin
TB_USUARIOS.Post;
showmessage('Contato inserido no banco de dados');
//limpa;
bloqueia;

end;

procedure TForm3.Button4Click(Sender: TObject);
begin
tb_usuarios.Delete;
 tb_usuarios.prior;
   carrega;
end;

procedure TForm3.Button6Click(Sender: TObject);
begin
 tb_usuarios.Next;
 carrega;

end;

procedure TForm3.Button7Click(Sender: TObject);
begin
  tb_usuarios.prior;
  carrega;
end;

procedure TForm3.Button8Click(Sender: TObject);
begin
opendialog1.Execute();
showmessage (opendialog1.filename);
image1.Picture.LoadFromFile(opendialog1.filename);
tb_usuarios.Edit;
tb_usuarios.FieldByName('foto').value := opendialog1.filename;
tb_usuarios.post;


end;

procedure TForm3.Button9Click(Sender: TObject);
begin
form3.Hide;
form5.show;
end;

procedure TForm3.ConectarClick(Sender: TObject);
begin
fdconnection1.Params.Database := GetCurrentdir+'\assets\banco-curso.mdb';
fdconnection1.Connected :=true;
TB_USUARIOS.TableName := 'usuarios';
tb_usuarios.Active :=true;


  if fdconnection1.Connected = true then
     begin
         STATUS.CAPTION       :='conectado';
     end;




end;

procedure TForm3.DBGrid1DblClick(Sender: TObject);
begin
 carrega;
end;

procedure TForm3.FormCreate(Sender: TObject);
begin
begin
fdconnection1.Params.Database := GetCurrentdir+'\assets\banco-curso.mdb';
fdconnection1.Connected :=true;
TB_USUARIOS.TableName := 'usuarios';
tb_usuarios.Active :=true;

  if fdconnection1.Connected = true then
     begin
       STATUS.CAPTION       :='conectado';
       carrega;
     end;
end;
end;

procedure TForm3.TB_USUARIOSBeforeInsert(DataSet: TDataSet);
begin
  bloqueia;
end;

procedure TForm3.TB_USUARIOSBeforePost(DataSet: TDataSet);
begin
  tb_usuarios.FieldByName('nome').value      := nome.Text;
  tb_usuarios.FieldByName('sobrenome').value := sobrenome.Text;
  tb_usuarios.FieldByName('permissao').value := permissao.Text;
  tb_usuarios.FieldByName('idade').value     := idade.Text;

end;

end.
